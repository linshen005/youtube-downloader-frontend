<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>YouTube to MP3/MP4 Downloader</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 50px;
            font-family: Arial, sans-serif;
        }
        input, select, button {
            margin: 10px;
            padding: 10px;
            width: 300px;
            font-size: 16px;
        }
        #result {
            margin-top: 20px;
            color: green;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>下载YouTube视频</h1>

    <input type="text" id="url" placeholder="请输入YouTube链接">
    
    <select id="format">
        <option value="mp3">MP3</option>
        <option value="mp4">MP4</option>
    </select>
    
    <button onclick="startDownload()">开始下载</button>

    <p id="result"></p>

    <script>
    function startDownload() {
        const url = document.getElementById('url').value.trim();
        const format = document.getElementById('format').value;

        if (!url) {
            document.getElementById('result').innerText = '请先输入YouTube链接';
            return;
        }

        document.getElementById('result').innerText = '正在请求，请稍等...';

        // 创建FormData对象
        const formData = new FormData();
        formData.append('url', url);
        formData.append('format', format);

        fetch('http://127.0.0.1:8001/download/?mode=json', {
            method: 'POST',
            body: formData  // 使用FormData代替URL编码的表单数据
        })
        .then(response => response.json())
        .then(data => {
            if (data.file_url) {
                // 确保使用完整的URL路径
                const fullUrl = `http://127.0.0.1:8001${data.file_url}`;
                
                // 创建一个隐藏的a标签并触发点击
                const a = document.createElement('a');
                a.href = fullUrl;
                a.download = data.file_name || '';  // 使用服务器返回的文件名
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                
                document.getElementById('result').innerText = '下载已开始！';
            } else {
                document.getElementById('result').innerText = '下载失败！' + (data.error || '请检查链接。');
            }
        })
        .catch(error => {
            console.error(error);
            document.getElementById('result').innerText = '请求失败，请检查服务器状态。';
        });
    }
    </script>
</body>
</html>